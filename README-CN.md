## note1: use v2.0 need change vercel setting from Gatsby to Vite

## note2: 2023.09.26 garmin need secret_string(and in Actions) get `python run_page/garmin_sync.py ${secret_string}` if cn `python run_page/garmin_sync.py ${secret_string} --is-cn`

# [打造个人户外运动主页](http://workouts.ben29.xyz)

![screenshot](https://user-images.githubusercontent.com/6956444/163125711-24d0ad99-490d-4c04-b89f-5b7fe776eb38.png)

简体中文 | [English](README.md)

本项目基于 [running_page](https://github.com/yihong0618/running_page/blob/master/README-CN.md) , 添加了支持多种运动类型。部署可参考原项目操作步骤

## 新增特性

# [打造个人跑步主页](https://yihong.run/running)

[English](README.md) | 简体中文 | [Wiki](https://wiki.mfydev.run/)

<details>
<summary>GIF 展示</summary>

![running_page](https://user-images.githubusercontent.com/15976103/98808834-c02f1d80-2457-11eb-9a7c-70e91faa5e30.gif)

</details>

## [大家的跑步主页展示](https://github.com/yihong0618/running_page/issues/12)

<details>
<summary>Running page runners</summary>

| Runner                                            | page                                           | App         |
| ------------------------------------------------- | ---------------------------------------------- | ----------- |
| [zhubao315](https://github.com/zhubao315)         | <https://zhubao315.github.io/running>          | Strava      |
| [shaonianche](https://github.com/shaonianche)     | <https://run.duanfei.org>                      | Strava      |
| [yihong0618](https://github.com/yihong0618)       | <https://yihong.run>                           | Nike        |
| [superleeyom](https://github.com/superleeyom)     | <https://running.leeyom.top>                   | Nike        |
| [geekplux](https://github.com/geekplux)           | <https://activities.geekplux.com>              | Nike        |
| [guanlan](https://github.com/guanlan)             | <https://grun.vercel.app>                      | Strava      |
| [tuzimoe](https://github.com/tuzimoe)             | <https://run.tuzi.moe>                         | Nike        |
| [ben_29](https://github.com/ben-29)               | <https://running.ben29.xyz>                    | Strava      |
| [kcllf](https://github.com/kcllf)                 | <https://running-tau.vercel.app>               | Garmin-cn   |
| [mq](https://github.com/MQ-0707)                  | <https://running-iota.vercel.app>              | Keep        |
| [zhaohongxuan](https://github.com/zhaohongxuan)   | <https://zhaohongxuan.github.io/workouts>      | Strava      |
| [yvetterowe](https://github.com/yvetterowe)       | <https://run.haoluo.io>                        | Strava      |
| [love-exercise](https://github.com/KaiOrange)     | <https://run.kai666666.top>                    | Keep        |
| [zstone12](https://github.com/zstone12)           | <https://running-page.zstone12.vercel.app>     | Keep        |
| [Lax](https://github.com/Lax)                     | <https://lax.github.io/running>                | Keep        |
| [lusuzi](https://github.com/lusuzi)               | <https://running.lusuzi.vercel.app>            | Nike        |
| [wh1994](https://github.com/wh1994)               | <https://run4life.fun>                         | Garmin      |
| [liuyihui](https://github.com/YiHui-Liu)          | <https://run.foolishfox.cn>                    | Keep        |
| [sunyunxian](https://github.com/sunyunxian)       | <https://sunyunxian.github.io/running_page>    | Strava      |
| [AhianZhang](https://github.com/AhianZhang)       | <https://running.ahianzhang.com>               | Nike        |
| [L1cardo](https://github.com/L1cardo)             | <https://run.licardo.cn>                       | Nike        |
| [luckylele666](https://github.com/luckylele666)   | <https://0000928.xyz>                          | Strava      |
| [MFYDev](https://github.com/MFYDev)               | <https://mfydev.run>                           | Garmin-cn   |
| [Oysmart](https://github.com/oysmart)             | <https://run.ouyang.wang>                      | Garmin-cn   |
| [Eished](https://github.com/eished)               | <https://run.iknow.fun>                        | Keep        |
| [Liuxin](https://github.com/liuxindtc)            | <https://liuxin.run>                           | Nike        |
| [loucx](https://github.com/loucx)                 | <https://loucx.github.io/running>              | Nike        |
| [winf42](https://github.com/winf42)               | <https://winf42.github.io>                     | Garmin-cn   |
| [sun0225SUN](https://github.com/sun0225SUN)       | <https://run.sunguoqi.com>                     | Nike        |
| [Zhan](https://www.zlog.in/about)                 | <https://run.zlog.in>                          | Nike        |
| [Dennis](https://run.domon.cn)                    | <https://run.domon.cn>                         | Garmin-cn   |
| [hanpei](https://running.nexts.top)               | <https://running.nexts.top>                    | Garmin-cn   |
| [liugezhou](https://github.com/liugezhou)         | <https://run.liugezhou.online>                 | Strava      |
| [zhubao315](https://github.com/zhubao315)         | <https://zhubao315.github.io/running>          | Strava      |
| [Jason Tan](https://github.com/Jason-cqtan)       | <https://jason-cqtan.github.io/running_page>   | Nike        |
| [Conge](https://github.com/conge)                 | <https://conge.github.io/running_page>         | Strava      |
| [cvvz](https://github.com/cvvz)                   | <https://cvvz.github.io/running>               | Strava      |
| [zHElEARN](https://github.com/zHElEARN)           | <https://workouts.zhelearn.com>                | Strava      |
| [Rhfeng](https://sport.frh.life)                  | <https://sport.frh.life>                       | Garmin-cn   |
| [Ym9i](https://github.com/Ym9i)                   | <https://bobrun.vercel.app/>                   | Strava      |
| [jianchengwang](https://github.com/jianchengwang) | <https://jianchengwang.github.io/running_page> | Suunto      |
| [fxbin](https://github.com/fxbin)                 | <https://fxbin.github.io/sport-records/>       | Keep        |
| [shensl4499](https://github.com/shensl4499)       | <https://waner.run>                            | codoon      |
| [haowei93](https://github.com/haowei93)           | <https://haowei93.github.io/>                  | gpx         |
| [stevenash0822](https://github.com/stevenash0822) | <https://run.imangry.xyz/>                     | Strava      |
| [Vint](https://github.com/VintLin)                | <https://vinton.store/Running/>                | Keep        |
| [Muyids](https://github.com/muyids)               | <https://muyids.github.io/running>             | Garmin-cn   |
| [Gao Hao](https://github.com/efish2002)           | <https://efish2002.github.io/running_page/>    | Garmin-cn   |
| [Jinlei](https://github.com/iamjinlei0312)        | <https://jinlei.run/>                          | AW-GPX      |
| [Ray Wang](https://github.com/raywangsy)          | <https://run.raywang.pro/>                     | Garmin      |
| [RealTiny656](https://github.com/tiny656)         | <https://tiny656.github.io/running_page/>      | JoyRun      |
| [EINDEX](https://github.com/eindex)               | <https://workouts.eindex.me/>                  | Strava/Nike |
| [Melt](https://github.com/fpGHwd)                 | <https://running.autove.dev/>                  | Strava      |
| [deepinwine](https://github.com/deepinwine)       | <https://deepin.autove.dev/>                   | Garmin-cn   |

</details>

## 它是怎么工作的

![image](https://github.com/yihong0618/running_page/assets/15976103/85d8d59d-2639-431e-8406-9d818afbd4ab)

## 特性

1. GitHub Actions 管理自动同步跑步进程及自动生成新的页面
2. 支持 Vercel(推荐) 和 GitHub Pages 自动部署
3. React Hooks
4. Mapbox 进行地图展示
5. Nike 及 Runtastic(Adidas Run) 以及佳明（佳明中国）及 Keep 等，自动备份 gpx 数据，方便备份及上传到其它软件

> 因为数据存在 gpx 和 data.db 中，理论上支持几个软件一起，你可以把之前各类 app 的数据都同步到这里（建议本地同步，之后 actions 选择正在用的 app）

> 注：如果你不想公开数据，可以选择 strava 的模糊处理，或 private 仓库。

<details>
<summary>缩放地图彩蛋</summary>

![image](https://user-images.githubusercontent.com/15976103/95644909-a31bcd80-0aec-11eb-9270-869b0a94f59f.png)

</details>

## 支持

- **[Strava](#strava)**
- **[Nike Run Club](#nike-run-club)**
- **[Garmin](#garmin)**
- **[Garmin-cn](#garmin-cn-大陆用户请用这个)**
- **[Keep](#keep)**
- **[悦跑圈](#joyrun悦跑圈，因悦跑圈限制单个设备原因，无法自动化)**
- **[咕咚](#codoon咕咚，因咕咚限制单个设备原因，无法自动化)**
- **[郁金香运动](#tulipsport)**
- **[GPX](#gpx)**
- **[TCX](#tcx)**
- **[FIT](#fit)**
- **[Tcx+Strava(upload all tcx data to strava)](#tcx_to_strava)**
- **[Gpx+Strava(upload all tcx data to strava)](#gpx_to_strava)**
- **[Nike+Strava(Using NRC Run, Strava backup data)](#nikestrava)**
- **[Garmin_to_Strava(Using Garmin Run, Strava backup data)](#garmin_to_strava)**
- **[Strava_to_Garmin(Using Strava Run, Garmin backup data)](#strava_to_garmin)**

## 视频教程

- https://www.youtube.com/watch?v=reLiY9p8EJk
- https://www.youtube.com/watch?v=VdNkFxTX5QQ

## 下载

```
git clone https://github.com/yihong0618/running_page.git --depth=1
```

## 安装及测试 (node >= 16 python >= 3.8)

```
pip3 install -r requirements.txt
npm install -g corepack && corepack enable && pnpm install
pnpm develop
```

访问 <http://localhost:5173/> 查看

## Docker

```
#构建
# NRC
docker build -t running_page:latest . --build-arg app=NRC --build-arg nike_refresh_token=""
# Garmin
docker build -t running_page:latest . --build-arg app=Garmin --build-arg secret_string=""
# Garmin-CN
docker build -t running_page:latest . --build-arg app=Garmin-CN --build-arg secret_string=""
# Strava
docker build -t running_page:latest . --build-arg app=Strava --build-arg client_id=""  --build-arg client_secret=""  --build-arg refresh_token=""
#Nike_to_Strava
docker build -t running_page:latest . --build-arg app=Nike_to_Strava  --build-arg nike_refresh_token="" --build-arg client_id=""  --build-arg client_secret=""  --build-arg refresh_token=""

#启动
docker run -itd -p 80:80   running_page:latest

#访问
访问 ip:80 查看

```

## 替换 `src/utils/const.js` 文件中的 Mapbox token

> 建议有能力的同学把代码中的 Mapbox token 自己的 [Mapbox token](https://www.mapbox.com/)

```javascript
const MAPBOX_TOKEN =
  'pk.eyJ1IjoieWlob25nMDYxOCIsImEiOiJja2J3M28xbG4wYzl0MzJxZm0ya2Fua2p2In0.PNKfkeQwYuyGOTT_x9BJ4Q';
```

### 如果你是海外用户请更改 `IS_CHINESE = false` in `src/utils/const.js`

## 一些个性化选项

### 自定义运动颜色

- 修改骑行颜色: `src/utils/const.js` 里的 `RIDE_COLOR`

### 新增运动类型

- 修改 `scripts/config.py`, `TYPE_DICT` 增加类型映射关系, `MAPPING_TYPE` 里增加运动类型
- 修改 `src/utils/const.js`, 增加类型标题，并加入到 `RUN_TITLES`
- 修改 `src/utils/util.js` 里的 `colorFromType`, 增加 case 指定颜色; `titleForRun`  增加 case 指定类型标题
- 参考这个 [commit](https://github.com/ben-29/workouts_page/commit/bfb6e9da4f72bdbdec669c42bdd10062558039cd)
- 或 [留言](https://github.com/ben-29/workouts_page/issues/20)
---

### Codoon（咕咚）

<details>
<summary>获取您的咕咚数据</summary>

```python
python3(python) run_page/codoon_sync.py ${your mobile or email} ${your password}
```

示例：

```python
python3(python) run_page/codoon_sync.py 13333xxxx xxxx
```

> 注：我增加了 Codoon 可以导出 gpx 功能, 执行如下命令，导出的 gpx 会加入到 GPX_OUT 中，方便上传到其它软件

```python
python3(python) run_page/codoon_sync.py ${your mobile or email} ${your password} --with-gpx
```

示例：

```python
python3(python) run_page/codoon_sync.py 13333xxxx xxxx --with-gpx
```

> 注：因为登录 token 有过期时间限制，我增加了 refresh_token&user_id 登陆的方式， refresh_token 及 user_id 在您登陆过程中会在控制台打印出来

![image](https://user-images.githubusercontent.com/6956444/105690972-9efaab00-5f37-11eb-905c-65a198ad2300.png)

示例：

```python
python3(python) run_page/codoon_sync.py 54bxxxxxxx fefxxxxx-xxxx-xxxx --from-auth-token
```

</details>

### 行者

<details>
<summary>获取您的行者数据</summary>

```python
python3(python) scripts/xingzhe_sync.py ${your mobile or email} ${your password}
```

示例：

```python
python3(python) scripts/xingzhe_sync.py 13333xxxx xxxx
```

> 注：我增加了 行者 可以导出 gpx 功能, 执行如下命令，导出的 gpx 会加入到 GPX_OUT 中，方便上传到其它软件

如果你使用 Garmin 作为数据源建议您将代码拉取到本地获取 Garmin 国际区的密钥，注意**Python 版本必须>=3.8**

#### 获取佳明国际区的密钥

在终端中输入以下命令

```python
# 获取密钥
python3(python) run_page/get_garmin_secret.py ${your email} ${your password}
```

#### 执行佳明国际区同步脚本

复制上述终端中输出的密钥，如果您是使用 Github 请在 Github Action 中配置**GARMIN_SECRET_STRING**参数

示例：

```python
python3(python) scripts/xingzhe_sync.py 13333xxxx xxxx --with-gpx
```

> 注：因为登录 token 有过期时间限制，我增加了 refresh_token&user_id 登陆的方式， refresh_token 及 user_id 在您登陆过程中会在控制台打印出来

### Garmin-CN (大陆用户请用这个)

<details>
<summary>获取您的 Garmin-CN 数据</summary>

如果你只想同步跑步数据请增加 --only-run

如果你想同步 `tcx` 格式，增加命令 --tcx

如果你想同步 `fit` 格式，增加命令 --fit

如果你使用 Garmin 作为数据源建议您将代码拉取到本地获取 Garmin 国际区的密钥，注意**Python 版本必须>=3.10**

#### 获取佳明国区的密钥

在终端中输入以下命令

```python
# to get secret_string
python3(python) run_page/get_garmin_secret.py ${your email} ${your password} --is-cn
```

![get_garmin_cn_secret](docs/get_garmin_cn_secret.jpg)

#### 执行佳明国区同步脚本

复制上述终端中输出的密钥，如果您是使用 Github 请在 Github Action 中配置**GARMIN_SECRET_STRING_CN** 参数
![get_garmin_secret](docs/add_garmin_secret_cn_string.jpg)
示例：

```python
python3(python) scripts/xingzhe_sync.py w0xxx 185000 --from-auth-token
```

</details>

### 自驾(Google 路书)

<details>
<summary>导入谷歌地图的KML路书</summary>

1. 使用 [谷歌地图](https://www.google.com/maps/d/) ，创建地图(路线放到同一个图层)
2. 把图层导出为 KML 文件
3. 把 kml 文件重命名为 `import.kml`, 放到 `scripts`目录
4. 修改`scripts/kml2polyline.py`, 填入路线相关信息

```
# TODO modify here
# 路线名称
track.name = "2020-10 西藏 Road Trip"
# 开始/结束时间 年月日时分
track.start_time = datetime(2020, 9, 29, 10, 0)
track.end_time = datetime(2020, 10, 10, 18, 0)
# 总路程
distance = 4000  # KM
# 总天数
days = 12
# 平均每天自驾时长
hours_per_day = 6
```

5. 控制台执行以下脚本

```python
python3(python) scripts\kml2polyline.py
```

</details>

# 致谢

- @[yihong0618](https://github.com/yihong0618) 特别棒的项目 [running_page](https://github.com/yihong0618/running_page) 非常感谢
